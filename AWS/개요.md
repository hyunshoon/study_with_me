본 포스팅은 Youtube [AWS Web Services Korea 스타트업을 위한 AWS 핵심 서비스](https://www.youtube.com/watch?v=vCNexbgYmQ8&list=PLORxAVAC5fUWoPJqJxJavUNK_QI8EFWP_&index=3) 를 기반으로 작성하였습니다.
## Goal

```
EC2 
ELB, Auto Scaling
서버리스 컴퓨터 에 대한 이해
```

## EC2

컴퓨팅 서비스

저장소
- Instance Store
- EBS

AMI(Amazon Machine Image)
- 인스턴스가 시작할 때 필요한 정보 제공

EC2는 광범위하고 세분화 된 플랫폼을 선택할 수 있다. (메모리, CPU 등)

![](https://velog.velcdn.com/images/hyunshoon/post/4e890ca5-61af-4939-bfae-6718dd4ca445/image.png)

인스턴스 표기법

인스턴스 분류

![](https://velog.velcdn.com/images/hyunshoon/post/24bdfdcf-ef3d-49cc-a8f2-4405f4ae48f0/image.png)


인스턴스 타입 선택 - 어떤 인스턴스 타입을 선택해야 할까?

1. 범용 웹 어플리케이션 서버
2. REST API 서비스인데, 트래픽이 많고 메시지 사이즈도 큰 경우

#### 최적의 인스턴스 및 크기 선택 방법

![](https://velog.velcdn.com/images/hyunshoon/post/a929dacb-2346-4bcf-bdb9-25fcf60591c0/image.png)

#### EC2 구매 옵션

온디맨드: 초 단위 지불 -> 예측 불가능한 워크 로드

예약 인스턴스: 1년 또는 약정으로 온디맨드 가격에서 대폭 할인 -> 안정적 수요

세이빙 플랜: 예약 인스턴스와 같은 할인에 좀더 높은 유연성 -> EC2 및 Fargate에 대해 저렴한 요금을 제공하는 유연한 요금 모델
 
스팟 인스턴스: 여분의 EC2 용량으로 온디맨드 가격에서 최대 90% 할인 제공 -> 내결함성, 유연성, 상태 비저장 워크로드

## 컴퓨팅 관련 추가 서비스 ELB


![](https://velog.velcdn.com/images/hyunshoon/post/42038427-7615-4662-b92b-c71363cf1281/image.png)

ELB
### ALB

Layer7
HTTP, HTTPS, Host Path Routing
### NLB

Layer4
TCP, UDP, TLS

### EC2 Auto Scaling

변화하는 수요에 동적으로 대응하고 비용을 최적화

![](https://velog.velcdn.com/images/hyunshoon/post/9a4f5c4a-07e3-4dd1-92c0-38b1f184423e/image.png)

### EC2 Auto Scaling 환경 구성하기

ASG(Auto Scaling Group)

#### Scaling Policy

Manual Scaling: 수동으로

Dynamic Scaling: 리소스 사용량에 따라

Scheduled Scaling: 스케줄에 따라

Predictive Scaling: 과거 패턴으로 학습

#### 인스턴스 시작 시 User Data 로 명령 실행

![](https://velog.velcdn.com/images/hyunshoon/post/cc7a5d84-5ae9-4140-9800-9738fa3b334f/image.png)

많이 사용함.

## 서버리스란?

### 특징

- 프로비저닝하고 관리할 인프라가 없다
- Pay for value
- 오토스케일링
- 고가용성, 보안

### 서버리스 서비스

![](https://velog.velcdn.com/images/hyunshoon/post/a289998e-7334-4539-ad4a-3661478549fd/image.png)

#### Fargate: 컨테이너를 위한 서버리스 컴퓨팅 엔진
장점
- 서버리스이므로 관리 비용이 낮다
- 비용 절감

![](https://velog.velcdn.com/images/hyunshoon/post/d3a48638-f40f-415e-994d-d325021e719c/image.png)

간단한 설정으로 컨테이너가 Faragate로 실행 가능

#### Lambda: 서버리스 이벤트 드리븐 코드 실행

100% 서버리스
함수 단위의 실행 환경
가용성 고려 할 필요 없다

다양한 코드 작성 및 배포 모델


EBS 블록 스토리지 생성하기
올바른 EBS 볼륨 선택하기
EBS 볼륨 변경 및 백업
관리형 데이터베이스로 전환
목적에 맞는 데이터에비스 선택 
S3를 활용한 정적 컨텐츠 부하 분산

# VPC 중심 네트워크 구성하기

Default VPC
보안 강화된 네트워크 위한 VPC 설계 전략
Hybrid Networking

![](https://velog.velcdn.com/images/hyunshoon/post/bfa34a03-960f-4c0c-aaca-e896e464a56c/image.png)

AWS 자원 레벨은 글로벌, 리전, 가용영역으로 이루어져있다.

VPC는 리전 레벨의 자원. 대표적으로 S3도 리전 레벨의 자원이다.

## VPC란?

온프레미스로 구축한다면 데이터 센터에서 물리적으로 네트워크 인프라를 구성해야한다. VPC는 기능은 동일하지만 물리가 아닌 가상의 논리적인 네트워크 인프라를 제공해주는 것.

## Defualt VPC 구성 

### 라우팅 테이블

![](https://velog.velcdn.com/images/hyunshoon/post/8196b238-a922-4799-926b-12a467b7e60a/image.png)


Default VPC는 모두 인터넷 게이트웨이를 가지고 있다. 

라우팅 테이블은 서브넷 레벨의 설정이다. 네 개의 서브넷(서울 리전인 경우 가용영역 네 개)은 하나의 라우팅 테이블에 연결 되어 있다. 

VPC 내부는 라우팅 테이블을 통해 서로 통신이 가능하다. 

그 외 IP 대역은 IGW를 통해 통신한다.

### NACL

![](https://velog.velcdn.com/images/hyunshoon/post/0cedcb23-429c-4e76-b140-f7688a74fccf/image.png)

네트워크 흐름 제어를 위해 NACL을 사용. 상태 비저장 방화벽을 위해 사용한다. 상태 비저장이기 때문에 인바운드와 아웃바운드 모두 설정해야한다. 서브넷 단위의 설정이다. 

기본 설정은 Any to Any 이다. 

Rule 번호를 기준으로 퍼미션의 우선순위가 결정된다. Rule 1에서 막은 것을 Rule 10에서 허용해도 허용 되지 않는다.

### Security Group


![](https://velog.velcdn.com/images/hyunshoon/post/d0aa7df1-718f-4455-a12f-1fc150591ea1/image.png)

보안 그룹은 상태 저장 방화벽이다.


## 보안 강화된 네트워크를 위한 VPC 설계 전략


### CIDR(Classless Inter-Domain Routing) 이란?

클래스 없이 유연하게 네트워크 영역을 나누어 IP 주소를 할당하는 방식

![](https://velog.velcdn.com/images/hyunshoon/post/50c4d8eb-b9a1-4d8c-93d7-cd4cada72b6f/image.png)

### VPC 대역 정하기

- IPv4의 경우 /16 ~ /28 넷마스크 허용
- RFC 1918에 정의된 사설 IP 대역 사용 권장
-  - 10.0.0.0/8: 10.0.0.0 ~10.255.255.255
-  - 172.16.0.0/12: 172.16.0.0 ~ 172.31.255.255
-  - 192.168.0.0/16: 192.168.0.0 ~ 192.168.255.255
- VPC CIDR 변경 불가. 대역 추가는 가능
- 서브넷마다 예약된 IP 고려 필요

### VPC Subnetting

![](https://velog.velcdn.com/images/hyunshoon/post/f1416c87-4d4f-4261-8027-0e873dbe01e5/image.png)

VPC IP 대역으로 할당된 대역을 하나의 라우팅

#### VPC Subnet 모범 사례

![](https://velog.velcdn.com/images/hyunshoon/post/9e602ba8-1130-48e6-b792-ac8f3193c536/image.png)


VPC에서 인터넷으로 노출시킬 표면적을 최소화

서브넷은 라우팅 테이블과 연결하여 네트워크 흐름을 제어할 수 있다.

우선, 외부 통신이 가능한 퍼블릭 서브넷과 프라이빗 서브넷을 분리한다. 퍼블릭 서브넷은 인터넷과 양방향 통신이 가능하므로 필요한 서버를 제외하고는 배치하지 않는 것이 좋다. 이를 통해 VCP에서 배포된 서버들이 인터넷으로 노출되는 것을 최소화 할 수 있다.

#### VPC Routing 전략

![image](https://user-images.githubusercontent.com/28949162/220146930-2585a8ba-faf3-43e0-acd8-51658b622909.png)

인터넷과 양방향 통신이 필요한가?

퍼블릭 서브넷은 VPC 대역외의 모든 IP를 IGW와 통신



Reference

- https://www.youtube.com/watch?v=vCNexbgYmQ8&list=PLORxAVAC5fUWoPJqJxJavUNK_QI8EFWP_&index=3









